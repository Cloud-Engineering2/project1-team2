<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>주차 관리 시스템</title>
    <!-- 부트스트랩 css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- pretendard 한글 폰트 -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css" />
    <link rel="stylesheet" href="style/style.css" />

    <style>
        /* 폰트 적용 */
        body {
            font-family: 'Pretendard', sans-serif;
        }

        /* 네비게이션 바 */
        nav {
            background-color: #7695FF; /* 네비게이션 바 색상 */
            padding: 10px 20px;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0; /* margin을 0으로 설정 */
            align-items: center; /* 수직 정렬 */
        }

        .nav-links li {
            margin-right: 20px;
            display: flex;
            align-items: center; /* 리스트 아이템 내부 수직 정렬 */
        }

        .nav-links a {
            text-decoration: none;
            color: white;
            font-weight: bold;
            padding: 10px 15px;
            transition: background-color 0.3s;
            display: inline-block; /* 높이 일관성을 위해 */
            line-height: 1; /* 텍스트 수직 중앙 정렬 */
        }


        .nav-links a:hover {
            background-color: #5d79b7; /* 호버 시 색상 */
        }

        /* 오른쪽에 '로그아웃' 버튼 */
        .logout {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 5px;
        }

        .logout:hover {
            background-color: #4a68a4; /* 호버 시 색상 */
        }

        /* 선택된 메뉴 항목 스타일 */
        .nav-links a.active {
            color: #FFD7C4; /* 선택된 페이지 글자 색상 */
        }
    </style>


</head>
<body>
<div th:replace="~{layout/header :: headerNav}"></div>

<div class="container mt-4">
    <h2 class="text-center fw-bold mb-4">차량 정보 조회</h2>

    <div class="row mb-3">
        <div class="col-9">
            <textarea class="form-control text-center" id="vNumber" placeholder="차량 번호를 입력해 주십시오" style="background-color: #F0F0F0;"></textarea>
        </div>
        <div class="col-3">
            <button class="btn btn-outline-secondary w-100" id="searchButton" disabled>
                <i class="bi bi-search"></i>
            </button>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-6">
            <input type="text" class="form-control text-center" readonly style="background-color: #F0F0F0;" th:attr="value='총 ' + ${totalVehicles} + '대'">
        </div>
        <div class="col-6">
            <input type="text" class="form-control text-center" readonly style="background-color: #F0F0F0;" th:attr="value='블랙리스트 ' + ${totalBlackLists} + '대'">
        </div>
    </div>

    <div class="mb-3 p-3" style="background-color: #FFD7C4; color: black;">
        <div class="row">
            <div class="col text-center">차량 번호</div>
            <div class="col text-center">전화번호</div>
            <div class="col text-center">차종</div>
            <div class="col text-center">블랙리스트</div>
        </div>
    </div>

    <div th:each="vehicle : ${vehicles}">
        <div class="mb-2 p-3" th:style="'background-color: ' + (${vehicle.isBlacklisted} == true ? '#FF9874' : '#9DBDFF')"> <!-- 블랙리스트 등록 차량이면 배경색을 #FF9874 로 설정, 그렇지 않으면 #9DBDFF 로 설정 -->
            <div class="row">
                <div class="col text-center" th:text="${vehicle.number}"></div> <!-- 차량 번호 -->
                <div class="col text-center" th:text="${vehicle.ownerTel}"></div> <!-- 전화번호 -->
                <div class="col text-center" th:text="${vehicle.type}"></div> <!-- 차종 -->
                <div class="col text-center"> <!-- 블랙리스트 등록 / 해제 -->
                    <a th:href="@{'/admin/vehicle/search/setBlacklist?vehicleId=' + ${vehicle.id}}"
                       class="btn" style="background-color: #FFD7C4; color: black; padding: 5px 20px; text-align: center; display: inline-block; border-radius: 5px;">
                        <span th:text="${vehicle.isBlacklisted ? '해제' : '등록'}"></span>
                    </a>
                </div>
                <!--                <div class="col text-center" th:text="${vehicle.isBlacklisted == true ? '해제' : '등록'}"></div>-->
            </div>
        </div>
    </div>

    <ul class="pagination justify-content-center my-3">
        <!-- 이전 페이지 버튼 -->
        <li class="page-item">
            <a class="page-link" th:classappend="${vehicles.hasPrevious()} ? '' : 'disabled'"
               th:href="@{/admin/vehicle/search(page=${vehicles.number - 1}, vNumber=${param.vNumber != null ? param.vNumber : ''})}">Previous</a>
        </li>

        <!-- 페이지 번호 목록 -->
        <li class="page-item" th:each="pagingNumber : ${pagingNumbers}"
            th:classappend="${pagingNumber == vehicles.number} ? 'active' : ''">
            <a class="page-link" th:href="@{/admin/vehicle/search(page=${pagingNumber}, vNumber=${param.vNumber != null ? param.vNumber : ''})}"
               th:text="${pagingNumber + 1}">1</a>
        </li>

        <!-- 다음 페이지 버튼 -->
        <li class="page-item">
            <a class="page-link" th:classappend="${vehicles.hasNext()} ? '' : 'disabled'"
               th:href="@{/admin/vehicle/search(page=${vehicles.number + 1}, vNumber=${param.vNumber != null ? param.vNumber : ''})}">Next</a>
        </li>
    </ul>
</div>


<div th:replace="~{layout/footer :: footerLayout}"></div>
</body>

<script>
    const vNumberInput = document.getElementById('vNumber'); // 차량 번호 입력란 get
    const searchButton = document.getElementById('searchButton'); // 검색 버튼 get

    // 차량 번호 입력란 - 입력 이벤트 추가
    vNumberInput.addEventListener('input', function() {
        // 차량 번호가 입력 => 버튼 활성화
        if (vNumberInput.value.trim() !== "") {
            searchButton.disabled = false;  // 버튼 활성화
        } else {
            searchButton.disabled = true;   // 버튼 비활성화
        }
    });

    // 검색 버튼 클릭 시 동작 정의.
    searchButton.addEventListener('click', function() {
        const vNumber = vNumberInput.value.trim();
        if (vNumber) {
            // 차량 번호 입력 => 이동
            window.location.href = '/admin/vehicle/search?vNumber=' + encodeURIComponent(vNumber);
        }
    });
</script>
</html>